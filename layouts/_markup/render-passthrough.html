{{- $opts := dict "output" "htmlAndMathml" "displayMode" (eq $.Type "block") }}
{{- with try (transform.ToMath .Inner $opts) }}
  {{- with .Err }}
    {{- warnf "Unable to render mathematical markup to HTML using the transform.ToMath function. The KaTeX display engine threw the following error: %s: see %s." . $.Position }}
    {{- if eq $.Type "block" -}}
      <p><mark class="text-danger">KaTeX rendering error!</mark></p>
    {{- else -}}
      <mark class="text-danger">KaTeX rendering error</mark>
    {{- end -}}
  {{- else }}
    {{- .Value }}
    {{- $.Page.Store.Set "hasMath" true -}}
  {{- end }}
{{- end -}}
